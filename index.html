<!DOCTYPE html>
<html>
<head>
    <title>Santa Face Swap</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #f0f2f5; padding: 20px; }
        .container { background: white; padding: 20px; border-radius: 15px; display: inline-block; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-top: 8px solid #d42426; }
        canvas { border: 4px solid #228b22; border-radius: 10px; max-width: 100%; margin-top: 20px; background: #eee; }
        button { background: #d42426; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #status { color: #d42426; font-weight: bold; margin: 10px; display: block; }
    </style>
</head>
<body>

    <h1>ðŸŽ… Santa Face Swap ðŸŽ„</h1>
    <div class="container">
        <span id="status">Initializing AI...</span>
        <input type="file" id="upload" accept="image/*">
        <br><br>
        <button id="download" style="display:none">Download Photo</button>
    </div>
    <br>
    <canvas id="canvas"></canvas>

    <script>
        const upload = document.getElementById('upload');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const status = document.getElementById('status');
        const downloadBtn = document.getElementById('download');

        const santaImg = new Image();
        santaImg.crossOrigin = "anonymous";
        // Using a reliable Santa template
        santaImg.src = 'https://img.freepik.com/free-vector/santa-claus-holding-empty-frame_1308-78243.jpg';

        const faceDetection = new FaceDetection({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/${file}`
        });

        faceDetection.setOptions({ model: 'short', minDetectionConfidence: 0.5 });

        faceDetection.onResults((results) => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(santaImg, 0, 0, canvas.width, canvas.height);

            if (results.detections.length > 0) {
                const face = results.detections[0].boundingBox;
                const userImg = upload.userImage;

                // Position for Santa's Face
                const tx = canvas.width * 0.44; 
                const ty = canvas.height * 0.22;
                const tw = canvas.width * 0.18;
                const th = canvas.height * 0.22;

                ctx.save();
                ctx.beginPath();
                ctx.ellipse(tx + tw/2, ty + th/2, tw/2, th/2, 0, 0, Math.PI * 2);
                ctx.clip();
                
                // Draw user face
                ctx.drawImage(userImg, 
                    face.xCenter * userImg.width - (face.width * userImg.width / 2),
                    face.yCenter * userImg.height - (face.height * userImg.height / 2),
                    face.width * userImg.width, face.height * userImg.height,
                    tx, ty, tw, th
                );
                ctx.restore();
                status.innerText = "âœ… Ho Ho Ho! Success!";
                downloadBtn.style.display = "inline-block";
            } else {
                status.innerText = "âŒ No face found. Try another photo!";
            }
        });

        upload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (f) => {
                const img = new Image();
                img.onload = () => {
                    upload.userImage = img;
                    canvas.width = santaImg.width;
                    canvas.height = santaImg.height;
                    status.innerText = "ðŸª„ Magic in progress...";
                    faceDetection.send({image: img});
                };
                img.src = f.target.result;
            };
            reader.readAsDataURL(file);
        });

        santaImg.onload = () => { status.innerText = "âœ… Ready! Upload a face."; };
        downloadBtn.onclick = () => {
            const a = document.createElement('a');
            a.download = 'santa-me.png';
            a.href = canvas.toDataURL();
            a.click();
        };
    </script>
</body>
</html>
